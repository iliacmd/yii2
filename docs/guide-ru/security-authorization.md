Авторизация
=========

Примечание: Раздел находится в стадии разработки

Авторизация это процесс проверки того, имеет ли пользователь достаточно прав сделать что либо. Yii предоставляет два метода авторизации: Фильтр контроля доступа (ACF) и Role-Based Access Control (RBAC).

### Фильтр контроля доступа (ACF)

Фильтр контроля доступа (ACF) является простым способом авторизации, который лучше всего использовать в приложениях, которым нужен простой контроль доступа. Как видно из его названия, ACF является фильтром “действия”, который присоединяется к контроллеру или модулю как поведение. ACF будет проверять набор правил доступа, чтобы убедиться, текущий пользователь может получить доступ к запрошенной операции.

Приведенный ниже код показывает, как использовать ACF который реализуется yii\filters\AccessControl:

```php
use yii\filters\AccessControl;
class SiteController extends Controller
{
    public function behaviors()
    {
        return [
            'access' => [
                'class' => AccessControl::className(),
                'only' => ['login', 'logout', 'signup'],
                'rules' => [
                    [
                        'allow' => true,
                        'actions' => ['login', 'signup'],
                        'roles' => ['?'],
                    ],
                    [
                        'allow' => true,
                        'actions' => ['logout'],
                        'roles' => ['@'],
                    ],
                ],
            ],
        ];
    }
    // ...
}
```


В приведенном выше коде ACF прикреплен к контроллеру сайта как поведение. Это типичный способ использования фильтра действий. Опция only указывает, что ACF следует применять только для входа, выхода из системы и действию регистрации. Опция rules устанавливает правила доступа, которая гласит:

Разрешить гостям (ещё не прошедшим утентификацию) пользователям получать доступ к действиям «Вход» и «Регистрация». Опция role содержит вопросительный знак ? который является специальным маркером «гостей».
Позволить авторизованным пользователям доступ к действию "Выход". Символ @ другой специальная маркер, признак авторизованных пользователей.

Когда ACF выполняет проверку авторизации, он будет рассматривать правила, по одному друг за другом сверху вниз до тех пор, пока не найдет совпадения. Значение allow правил соответствия будет использоваться для оценки, если пользователь авторизовался. Если ни одно из правил не выполнено, то пользователь не имеет прав и ACF остановит дальнейшее выполнение действий.

По умолчанию, ACF когда определяет, что пользователь не имеет доступа к текущему дествию, он делает что-то одно из указаного ниже:

Если пользователь гость, он вызовет Yii\Web\User::loginRequired(), который перенаправляет браузер на страницу входа в систему.
Если пользователь уже идентифицирован, будет выбрасывать исключение \Web \ForbiddenHttpException.

Вы можете настроить это поведение путем задания свойства Yii\Фильтр\AccessControl::$denyCallback:

```php
[
    'class' => AccessControl::className(),
    'denyCallback' => function ($rule, $action) {
        throw new \Exception('You are not allowed to access this page');
    }
]
```

Правила доступа поддерживаютмножество опций. Ниже приводится краткая информация о поддерживаемых опциях. Вы также можете расширить класс yii\filters\AccessRule создавая свои собственные индивидуальные правила доступа.

allow: опрделяет является ли праило "разрешением" или "запретом".

actions: определяет к каким действиям применяетя правило. Указывается  массив идентификаторов действий. При сравнении учитывается регистр. Если данная опция пустая или не установлена, то правило применяется ко всем действиям.

controllers: определяет к действиям каких контроллеров применятеся правило. Указывается массив идентификаторов контроллеров. При сравнении учитывается регистр. Если данная опция пустая или не установлена, то правило применяется ко всем контроллерам.

roles: определяет, для каких ролей пользователей применяется правило. Существует две роли, кторый определены в  \Web\User::$ isGuest:
  ? : Соответствует пользователю, гость (пользователь не прошедший аутентификацию)
  @ : Соответсвует аутентифицированному пользователю
Использование других ролей требует RBAC (будет описан в следующем разделе), и вызова yii\web\User::can().Если опция roles пуста или не установлена, правило применяется ко всем ролям.
